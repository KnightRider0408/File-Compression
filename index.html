<!-- templates/index.html -->
<!-- Previous CSS styles remain the same -->
<script>
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const form = e.target;
        const submitButton = form.querySelector('button');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsDiv = document.getElementById('compressionResults');
        const errorDiv = document.getElementById('errorMessage');
        const downloadButton = document.getElementById('downloadButton');
        
        // Reset UI
        submitButton.disabled = true;
        loadingIndicator.style.display = 'block';
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        try {
            const formData = new FormData(form);
            const response = await fetch('/compress', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Update results
            document.getElementById('originalSize').textContent = data.original_size;
            document.getElementById('compressedSize').textContent = data.compressed_size;
            document.getElementById('compressionRatio').textContent = data.compression_ratio;
            
            // Set up download button
            downloadButton.href = data.download_url;
            downloadButton.addEventListener('click', function(e) {
                // Remove the button after download starts
                setTimeout(() => {
                    resultsDiv.innerHTML += '<p>Download started! You can compress another file.</p>';
                    downloadButton.style.display = 'none';
                }, 1000);
            });
            
            // Show results
            resultsDiv.style.display = 'block';
            
        } catch (error) {
            errorDiv.textContent = error.message || 'An error occurred during compression';
            errorDiv.style.display = 'block';
        } finally {
            submitButton.disabled = false;
            loadingIndicator.style.display = 'none';
        }
    });
</script>
